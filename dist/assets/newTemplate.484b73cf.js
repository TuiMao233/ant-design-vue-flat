import{u as e,j as a,aA as l,b7 as i,c as t,b8 as n,b5 as r}from"./index.a53c91c6.js";import{i as u}from"./reset-time.7778decd.js";import{a as o,l as d,m as p,b as m,o as s,c,g as v,t as _,s as h,u as g,k as w,p as f,X as y,h as V}from"./vendor.71e19cde.js";const b=w();f("data-v-4916e882");const F=y("按件收费"),N=y("按重量收费"),x=v("div",{class:"tips-text"},"保存模板后，编辑不可修改",-1),U={key:0},k={key:1},E={class:"oe-flex region-inp"},j=v("div",null,"初发数量",-1),I=y("个"),$={class:"oe-flex region-inp",style:{"margin-top":"28px"}},C=v("div",null,"初发运费",-1),D=y("元"),q={class:"oe-flex region-inp"},A=v("div",null,"续发数量",-1),S=y("个"),K={class:"oe-flex region-inp",style:{"margin-top":"28px"}},X=v("div",null,"续发运费",-1),z=y("元"),B=y("删除"),G={key:0},H={key:1},J={class:"oe-flex region-inp"},L=v("div",null,"初发首重",-1),M=y("Kg"),O={class:"oe-flex region-inp",style:{"margin-top":"28px"}},P=v("div",null,"初发运费",-1),Q=y("元"),R={class:"oe-flex region-inp"},T=v("div",null,"续发续重",-1),W=y("Kg"),Y={class:"oe-flex region-inp",style:{"margin-top":"28px"}},Z=v("div",null,"续发运费",-1),ee=y("元"),ae=y("删除"),le=y("新增支持配送区域"),ie=v("div",{class:"tips-text"}," 根据发货数量计算相应的运费，当发货数量≤初发数量，按初发费用计算，超过数量则按续发数量/总量与续发费用乘积计算 ",-1),te={class:"oe-flex oe-row-center"},ne=y("取消"),re=y("保存");V();var ue=o({expose:[],setup(o){const w=e(),f=a(),y=d(""),V=d({dispatch_name:"",calculate_type:"1",noDelivery:[]}),ue=d([]),oe=d({provinces:[],citys:[],areas:[],text:"",original:[]}),de=d([]),pe=d([]),me=d([{name:"全国统一收费",initialNum:"",initialFreight:"",renewalNum:"",renewaFreight:""}]),se=d(""),ce=d([{name:"全国统一收费",initialNum:"",initialFreight:"",renewalNum:"",renewaFreight:""}]),ve=()=>{if("1"==V.value.calculate_type){const e={name:[],initialNum:"",initialFreight:"",renewalNum:"",renewaFreight:""};me.value.push(e)}else{const e={name:[],initialNum:"",initialFreight:"",renewalNum:"",renewaFreight:""};ce.value.push(e)}},_e=e=>{"1"==V.value.calculate_type?me.value.splice(e.$index,1):ce.value.splice(e.$index,1)};l().then((e=>{ue.value=e.data.data}));const he=d({dispatch_name:[{required:!0,message:"请填写模板名称",trigger:"blur"}],calculate_type:[{required:!0,message:"请选择",trigger:"blur"}],distributionArea:[{required:!0,validator:(e,a,l)=>{if("1"==V.value.calculate_type){let e=!1;me.value.forEach((a=>{e=""!=a.initialNum&&""!=a.initialFreight&&""!=a.renewalNum&&""!=a.renewaFreight&&0!=a.name.length})),e?l():l(new Error("请填写完整的模板"))}else if("0"==V.value.calculate_type){let e=!1;ce.value.forEach((a=>{e=""!=a.initialNum&&""!=a.initialFreight&&""!=a.renewalNum&&""!=a.renewaFreight&&0!=a.name.length})),e?l():l(new Error("请填写完整的模板"))}},trigger:"blur"}]}),ge=()=>{V.value.noDelivery.length&&fe(1),y.value.validate((e=>{e&&we()}))},we=async()=>{if("1"==V.value.calculate_type){me.value.forEach((e=>{"全国统一收费"!=e.name&&fe(2,e)}));const e={dispatch_name:V.value.dispatch_name,calculate_type:V.value.calculate_type,start_num:me.value[0].initialNum,start_num_price:me.value[0].initialFreight,add_num:me.value[0].renewalNum,add_num_price:me.value[0].renewaFreight,dispatch_area:de.value,dispatch_limit_area_code:[oe.value]};se.value&&(e.id=se.value),await i(e)}else if("0"==V.value.calculate_type){ce.value.forEach((e=>{"全国统一收费"!=e.name&&fe(3,e)}));const e={dispatch_name:V.value.dispatch_name,calculate_type:V.value.calculate_type,start_weight:ce.value[0].initialNum,start_weight_price:ce.value[0].initialFreight,add_weight:ce.value[0].renewalNum,add_weight_price:ce.value[0].renewaFreight,dispatch_area:pe.value,dispatch_limit_area_code:[oe.value]};se.value&&(e.id=se.value),await i(e)}t.success("操作成功"),w.go(-1)},fe=(e,a)=>{if(1==e){const e=e=>[...new Set(V.value.noDelivery.map((a=>a[e])).filter((e=>void 0!==e)))];oe.value.provinces=e(0),oe.value.citys=e(1),oe.value.areas=e(2);const a=ue.value.map((e=>e.children)),l=[];a.forEach((e=>{e.forEach((e=>{if(!oe.value.citys.some((a=>e.id===a)))return!1;const a=e.children.filter((e=>oe.value.areas.some((a=>a===e.id)))),i=n(a.map((e=>e.name)).join(","),15);l.push(`${e.name}${i?`(${i})`:""}`)}))})),oe.value.text=l.join(", "),oe.value.original=V.value.noDelivery}else if(2==e||3==e){let l=[],i=[];const t=e=>[...new Set(a.name.map((a=>a[e])).filter((e=>void 0!==e)))];l=t(1),i=t(2);const r=ue.value.map((e=>e.children)),u=[];r.forEach((e=>{e.forEach((e=>{if(!l.some((a=>e.id===a)))return!1;const a=e.children.filter((e=>i.some((a=>a===e.id)))),t=n(a.map((e=>e.name)).join(","),15);u.push(`${e.name}${t?`(${t})`:""}`)}))})),2==e?de.value.push({provinces:t(0),citys:t(1),areas:t(2),text:u.join(","),first_num:a.initialNum,first_price:a.initialFreight,second_num:a.renewalNum,second_price:a.renewaFreight,original:a.name}):pe.value.push({provinces:t(0),citys:t(1),areas:t(2),text:u.join(","),first_num:a.initialNum,first_price:a.initialFreight,second_num:a.renewalNum,second_price:a.renewaFreight,original:a.name})}};return p((()=>{f.query.id&&(se.value=f.query.id,(async()=>{const{data:e}=await r({id:se.value}),a=e.data.data[0];1==a.calculate_type?(me.value[0].initialNum=a.start_num,me.value[0].initialFreight=a.start_num_price,me.value[0].renewalNum=a.add_num,me.value[0].renewaFreight=a.add_num_price,a.dispatch_area.forEach((e=>{e.original=e.original.map((e=>e.map(Number))),me.value.push({name:e.original,initialNum:e.first_num,initialFreight:e.first_price,renewalNum:e.second_num,renewaFreight:e.second_price})}))):(ce.value[0].initialNum=a.start_weight,ce.value[0].initialFreight=a.start_weight_price,ce.value[0].renewalNum=a.add_weight,ce.value[0].renewaFreight=a.add_weight_price,a.dispatch_area.forEach((e=>{e.original=e.original.map((e=>e.map(Number))),ce.value.push({name:e.original,initialNum:e.first_num,initialFreight:e.first_price,renewalNum:e.second_num,renewaFreight:e.second_price})}))),a.dispatch_limit_area_code&&(a.dispatch_limit_area_code[0].original=a.dispatch_limit_area_code[0].original.map((e=>e.map(Number))),V.value.noDelivery=a.dispatch_limit_area_code[0].original),V.value.dispatch_name=a.dispatch_name,V.value.calculate_type=a.calculate_type,V.value.calculate_type=V.value.calculate_type.toString()})())})),b(((e,a)=>{const l=m("el-input"),i=m("el-form-item"),t=m("el-radio"),n=m("el-radio-group"),r=m("el-cascader"),o=m("el-table-column"),d=m("el-button"),p=m("el-table"),f=m("el-card"),oe=m("el-form");return s(),c(oe,{model:V.value,ref:y,rules:he.value,"label-width":"110px",class:"notice-box"},{default:b((()=>[v(f,{shadow:"never"},{default:b((()=>[v(i,{label:"模板名称",prop:"dispatch_name"},{default:b((()=>[v(l,{class:"sort-inp",modelValue:V.value.dispatch_name,"onUpdate:modelValue":a[1]||(a[1]=e=>V.value.dispatch_name=e),placeholder:"请输入模板名称"},null,8,["modelValue"])])),_:1}),v(i,{label:"收费方式",prop:"calculate_type"},{default:b((()=>[v(n,{modelValue:V.value.calculate_type,"onUpdate:modelValue":a[2]||(a[2]=e=>V.value.calculate_type=e),disabled:""!=se.value},{default:b((()=>[v(t,{label:"1"},{default:b((()=>[F])),_:1}),v(t,{label:"0"},{default:b((()=>[N])),_:1})])),_:1},8,["modelValue","disabled"]),x])),_:1}),v(i,{label:"支持配送区域",prop:"distributionArea"},{default:b((()=>["1"==V.value.calculate_type?(s(),c(p,{key:0,data:me.value},{default:b((()=>[v(o,{label:"支持区域",prop:"name"},{default:b((e=>["全国统一收费"==e.row.name?(s(),c("div",U,_(e.row.name),1)):h("",!0),"全国统一收费"!=e.row.name?(s(),c("div",k,[v(r,{class:"multiple-inp",modelValue:e.row.name,"onUpdate:modelValue":a=>e.row.name=a,clearable:"",options:ue.value,props:{value:"id",label:"name",children:"children",multiple:!0}},null,8,["modelValue","onUpdate:modelValue","options"])])):h("",!0)])),_:1}),v(o,{label:"初发件",prop:"name"},{default:b((e=>[v("div",E,[j,v(l,{modelValue:e.row.initialNum,"onUpdate:modelValue":a=>e.row.initialNum=a,type:"number"},{append:b((()=>[I])),_:2},1032,["modelValue","onUpdate:modelValue"])]),v("div",$,[C,v(l,{modelValue:e.row.initialFreight,"onUpdate:modelValue":a=>e.row.initialFreight=a,type:"number",onInput:a=>e.row.initialFreight=g(u)(e.row.initialFreight)},{append:b((()=>[D])),_:2},1032,["modelValue","onUpdate:modelValue","onInput"])])])),_:1}),v(o,{label:"续发件",prop:"name"},{default:b((e=>[v("div",q,[A,v(l,{type:"number",modelValue:e.row.renewalNum,"onUpdate:modelValue":a=>e.row.renewalNum=a},{append:b((()=>[S])),_:2},1032,["modelValue","onUpdate:modelValue"])]),v("div",K,[X,v(l,{modelValue:e.row.renewaFreight,"onUpdate:modelValue":a=>e.row.renewaFreight=a,type:"number",onInput:a=>e.row.renewaFreight=g(u)(e.row.renewaFreight)},{append:b((()=>[z])),_:2},1032,["modelValue","onUpdate:modelValue","onInput"])]),"全国统一收费"!=e.row.name?(s(),c(d,{key:0,class:"delete-btn",type:"text",onClick:a=>_e(e)},{default:b((()=>[B])),_:2},1032,["onClick"])):h("",!0)])),_:1})])),_:1},8,["data"])):h("",!0),"0"==V.value.calculate_type?(s(),c(p,{key:1,data:ce.value},{default:b((()=>[v(o,{label:"支持区域",prop:"name"},{default:b((e=>["全国统一收费"==e.row.name?(s(),c("div",G,_(e.row.name),1)):h("",!0),"全国统一收费"!=e.row.name?(s(),c("div",H,[v(r,{class:"multiple-inp",clearable:"",modelValue:e.row.name,"onUpdate:modelValue":a=>e.row.name=a,options:ue.value,props:{value:"id",label:"name",children:"children",multiple:!0}},null,8,["modelValue","onUpdate:modelValue","options"])])):h("",!0)])),_:1}),v(o,{label:"初发件",prop:"name"},{default:b((e=>[v("div",J,[L,v(l,{modelValue:e.row.initialNum,"onUpdate:modelValue":a=>e.row.initialNum=a,type:"number"},{append:b((()=>[M])),_:2},1032,["modelValue","onUpdate:modelValue"])]),v("div",O,[P,v(l,{modelValue:e.row.initialFreight,"onUpdate:modelValue":a=>e.row.initialFreight=a,type:"number",onInput:a=>e.row.initialFreight=g(u)(e.row.initialFreight)},{append:b((()=>[Q])),_:2},1032,["modelValue","onUpdate:modelValue","onInput"])])])),_:1}),v(o,{label:"续发件",prop:"name"},{default:b((e=>[v("div",R,[T,v(l,{type:"number",modelValue:e.row.renewalNum,"onUpdate:modelValue":a=>e.row.renewalNum=a},{append:b((()=>[W])),_:2},1032,["modelValue","onUpdate:modelValue"])]),v("div",Y,[Z,v(l,{modelValue:e.row.renewaFreight,"onUpdate:modelValue":a=>e.row.renewaFreight=a,type:"number",onInput:a=>e.row.renewaFreight=g(u)(e.row.renewaFreight)},{append:b((()=>[ee])),_:2},1032,["modelValue","onUpdate:modelValue","onInput"])]),"全国统一收费"!=e.row.name?(s(),c(d,{key:0,class:"delete-btn",type:"text",onClick:a=>_e(e)},{default:b((()=>[ae])),_:2},1032,["onClick"])):h("",!0)])),_:1})])),_:1},8,["data"])):h("",!0),v(d,{type:"text",onClick:ve},{default:b((()=>[le])),_:1}),ie])),_:1}),v(i,{label:"不支持配送区域"},{default:b((()=>[v(r,{clearable:"",class:"multiple-inp",modelValue:V.value.noDelivery,"onUpdate:modelValue":a[3]||(a[3]=e=>V.value.noDelivery=e),options:ue.value,props:{value:"id",label:"name",children:"children",multiple:!0}},null,8,["modelValue","options"])])),_:1})])),_:1}),v(f,{shadow:"never",class:"operation"},{default:b((()=>[v("div",te,[v(d,{plain:"",onClick:a[4]||(a[4]=e=>g(w).go(-1))},{default:b((()=>[ne])),_:1}),v(d,{type:"primary",onClick:ge},{default:b((()=>[re])),_:1})])])),_:1})])),_:1},8,["model","rules"])}))}});ue.__scopeId="data-v-4916e882";export default ue;
