import{a as e,l,w as a,r as t,b as u,o as s,c as d,g as n,s as o,Z as i,F as c,P as r,t as p,X as v,u as m,k as f,p as _,h as y}from"./vendor.71e19cde.js";import{e as b,f as h}from"./marketing.64a7433e.js";import{u as g,aD as k,_ as x,c as w}from"./index.a53c91c6.js";const V=f();_("data-v-d608a77c");const C=n("div",{class:"discount-title"},"手动发券设置",-1),S={class:"manual-button"},U=v("添加优惠券"),j=n("p",{class:"tips-text"},"只可选择总数为无限制且正在发放中的优惠券，否则无法发放优惠券",-1),E=v("折扣券"),I=v("满减券"),q=n("div",{class:"discount-title"},"发送对象",-1),B=v("指定会员发送"),K=v("按会员等级发送"),T=v("全部发送"),A={key:0},D={class:"manual-button"},F=v("选择会员"),P=n("p",{class:"tips-text"},"可指定多位会员",-1),X={class:"appoint-member-list"},Z=n("i",{class:"el-icon-close yes"},null,-1),z={class:"left"},G={class:"rigth"},H={class:"title"},J={class:"bottom"},L={key:1},M=v("确认发送"),N=v("折扣券"),O=v("满减券"),Q={class:"footer"},R=v("优惠券设置"),W={class:"dialog-footer"},Y=v("取 消"),$=v("确 定");y();var ee=e({expose:[],setup(e){const f=g(),_=l(!1),y=l([]),ee=async()=>{_.value=!0;const e=await b({page:1,limit:2e3,search:{name:ae.value,status:"1",stock:"1"}});y.value=e.data.data.data},le=()=>{_.value=!1,ie.value.length>0&&ie.value.forEach((e=>{te.value.push(e)})),ie.value=[]},ae=l("");a(ae,ee);const te=l([]),ue=async()=>{const e=await k({multiple:!0});e.length>0&&e.forEach((e=>{se.value.every((l=>l.id!=e.id))&&(e.isSelect=!1,se.value.push(e))}))},se=l([]),de=l([]),ne=l([{name:"普通",value:"0"},{name:"一级",value:"1"},{name:"二级",value:"2"},{name:"三级",value:"3"},{name:"四级",value:"4"},{name:"五级",value:"5"},{name:"六级",value:"6"},{name:"七级",value:"7"},{name:"八级",value:"8"}]),oe=l(),ie=l([]),ce=()=>{ie.value.length?re.value=!0:re.value=!1},re=l(!1),pe=e=>{ie.value=e},ve=t({send_num:[{required:!0,message:"请填写每人发放张数",trigger:"blur"}],coupon_id:[{required:!0,message:"请选择优惠券",trigger:"blur"}]}),me=l({coupon_id:"",send_num:"",send_type:1,send_value:[]}),fe=l(),_e=()=>{x.confirm("您确定开始发放该优惠券么？","开始发放",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((()=>{if(te.value.length>0){const e=[];te.value.forEach((l=>{e.push(l.id)})),me.value.coupon_id=e.join()}if(1==me.value.send_type){const e=[];se.value.forEach((l=>{e.push(l.id)})),me.value.send_value=e}2==me.value.send_type&&(me.value.send_value=de.value),fe.value.validate((async e=>{if(!e)return!1;await h(me.value),w.success("发放成功")}))}))};return V(((e,l)=>{const a=u("el-button"),t=u("el-form-item"),b=u("el-table-column"),h=u("el-tag"),g=u("el-table"),k=u("el-input"),x=u("el-card"),w=u("el-col"),ie=u("el-row"),re=u("el-radio"),ye=u("el-radio-group"),be=u("el-image"),he=u("el-checkbox"),ge=u("el-checkbox-group"),ke=u("el-form"),xe=u("el-dialog");return s(),d(c,null,[n(ke,{ref:fe,class:"discount-from",rules:m(ve),model:me.value,"label-width":"125px"},{default:V((()=>[n(ie,{gutter:20},{default:V((()=>[n(w,null,{default:V((()=>[n(x,{shadow:"never"},{default:V((()=>[C,n(t,{label:"优惠券选择",prop:"coupon_id"},{default:V((()=>[n("div",S,[n(a,{onClick:ee,plain:""},{default:V((()=>[U])),_:1})]),j])),_:1}),te.value.length>0?(s(),d(g,{key:0,border:!1,class:"goods-list oe-m-l-30 oe-m-b-20",ref:oe,data:te.value,"tooltip-effect":"dark",style:{width:"60%"}},{default:V((()=>[n(b,{label:"优惠券名称",prop:"name"}),n(b,{label:"类型"},{default:V((e=>[2==e.row.type?(s(),d(h,{key:0,type:"success"},{default:V((()=>[E])),_:1})):(s(),d(h,{key:1,type:"danger"},{default:V((()=>[I])),_:1}))])),_:1}),n(b,{label:"使用说明",prop:"explain"}),n(b,{label:"操作"},{default:V((e=>[n("span",{style:{color:"var(--color-primary)"},onClick:l=>(e=>{const l=te.value.findIndex((l=>l.id==e));te.value.splice(l,1)})(e.row.id),type:"text"},"删除",8,["onClick"])])),_:1})])),_:1},8,["data"])):o("",!0),n(t,{label:"每人发送张数",prop:"send_num"},{default:V((()=>[n(k,{onKeyup:i(_e,["enter"]),class:"tips-inp",type:"number",modelValue:me.value.send_num,"onUpdate:modelValue":l[1]||(l[1]=e=>me.value.send_num=e),placeholder:"请输入数量"},null,8,["onKeyup","modelValue"])])),_:1})])),_:1})])),_:1})])),_:1}),n(ie,{gutter:20},{default:V((()=>[n(w,null,{default:V((()=>[n(x,{shadow:"never"},{default:V((()=>[q,n(t,{label:"发送类型"},{default:V((()=>[n("div",null,[n(ye,{modelValue:me.value.send_type,"onUpdate:modelValue":l[2]||(l[2]=e=>me.value.send_type=e)},{default:V((()=>[n(re,{label:1},{default:V((()=>[B])),_:1}),n(re,{label:2},{default:V((()=>[K])),_:1}),n(re,{label:3},{default:V((()=>[T])),_:1})])),_:1},8,["modelValue"])])])),_:1}),1==me.value.send_type?(s(),d("div",A,[n(t,{label:"指定会员"},{default:V((()=>[n("div",D,[n(a,{onClick:ue,plain:""},{default:V((()=>[F])),_:1})])])),_:1}),n(t,null,{default:V((()=>[P])),_:1}),n(t,null,{default:V((()=>[n("div",X,[(s(!0),d(c,null,r(se.value,(e=>(s(),d("div",{onClick:l=>e.isSelect=!e.isSelect,class:[{current:e.isSelect},"appoint-member-item"],key:e.id},[e.isSelect?(s(),d("div",{key:0,onClick:l=>(e=>{const l=se.value.findIndex((l=>l.id==e));se.value.splice(l,1)})(e.id),class:"icon"},[Z],8,["onClick"])):o("",!0),n("div",z,[n(be,{src:e.avatar},null,8,["src"])]),n("div",G,[n("div",H,p(e.nickname),1),n("div",J,[n(be,{src:e.user_channel_img},null,8,["src"])])])],10,["onClick"])))),128))])])),_:1})])):o("",!0),2==me.value.send_type?(s(),d("div",L,[n(t,{label:"领取限制"},{default:V((()=>[n(ge,{modelValue:de.value,"onUpdate:modelValue":l[3]||(l[3]=e=>de.value=e)},{default:V((()=>[(s(!0),d(c,null,r(ne.value,(e=>(s(),d(he,{label:e.value,key:e.value},{default:V((()=>[v(p(e.name),1)])),_:2},1032,["label"])))),128))])),_:1},8,["modelValue"])])),_:1})])):o("",!0),n(t,null,{default:V((()=>[n(a,{onClick:_e,type:"primary"},{default:V((()=>[M])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["rules","model"]),n(xe,{title:"添加优惠券",modelValue:_.value,"onUpdate:modelValue":l[7]||(l[7]=e=>_.value=e),width:"30%"},{footer:V((()=>[n("div",Q,[n(a,{onClick:l[5]||(l[5]=e=>m(f).push("allCoupon")),type:"text"},{default:V((()=>[R])),_:1}),n("span",W,[n(a,{onClick:l[6]||(l[6]=e=>_.value=!1)},{default:V((()=>[Y])),_:1}),n(a,{type:"primary",onClick:le},{default:V((()=>[$])),_:1})])])])),default:V((()=>[n("div",null,[n(k,{style:{width:"50%"},placeholder:"请输入内容","suffix-icon":"el-icon-search",modelValue:ae.value,"onUpdate:modelValue":l[4]||(l[4]=e=>ae.value=e)},null,8,["modelValue"]),n(g,{"max-height":"400",border:!1,class:"goods-list",ref:oe,data:y.value,"tooltip-effect":"dark",style:{width:"100%"},onSelectAll:ce,onSelectionChange:pe},{default:V((()=>[n(b,{type:"selection",width:"55"}),n(b,{label:"优惠券名称",prop:"name"}),n(b,{label:"类型",prop:"name"},{default:V((e=>[2==e.row.type?(s(),d(h,{key:0,type:"success"},{default:V((()=>[N])),_:1})):(s(),d(h,{key:1,type:"danger"},{default:V((()=>[O])),_:1}))])),_:1}),n(b,{label:"使用说明",prop:"explain"})])),_:1},8,["data"])])])),_:1},8,["modelValue"])],64)}))}});ee.__scopeId="data-v-d608a77c";export default ee;
