import{a as e,l as a,r as l,m as t,b as s,o,c as n,g as r,u as d,t as i,s as c,F as u,k as p,p as m,X as f,h as b}from"./vendor.71e19cde.js";import{a as g,f as w,c as v}from"./index.a53c91c6.js";import{y,z as x,A as h,B as _,C}from"./order.28ff7f57.js";const z=p();m("data-v-7e6fc5d3");const k={class:"delivery-tips"},U=f(" 1、 批量发货只适用于待发货状态的订单 "),j=r("br",null,null,-1),S=f(" 2、 如导入重复数据可能会出错，请谨慎使用"),A=r("br",null,null,-1),E=f(" 3、 一次性导入太多数据可能会比较慢，建议单次不要超过2000条 "),L=r("br",null,null,-1),B=f(" 4、批量发货模板第一列必须为订单编号，第二列必须为物流公司代码，第三列必须为快递单号"),F=r("br",null,null,-1),I=f(" 5、 如要有需要，可以下载模板文件 "),q={class:"tips-box"},O={class:"upload-container"},P=f("选择文件"),R={class:"oe-flex delivery-tips-box"},D=r("div",{class:"text"},"使用说明",-1),X=f(" 1、 您可以点击"),G=r("span",{style:{color:"#ff0000"}},"订单管理 - 待发货 -导出",-1),H=f(" 来获取待发货的订单编号，填写物流公司代码和快递单号 "),J=r("br",null,null,-1),K=f(" 2、上传文件，立即导入就可以进行批量发货了 "),M=r("i",{class:"ad-question-mark",style:{color:"#000","font-size":"16px"}},null,-1),N=f("立即导入"),Q=f("导出失败订单");b();var T=e({expose:[],setup(e){const{pagination:p,handleSizeChange:m,handleCurrentChange:f}=g(),b=a(),T=a([]),V=a({fileUrl:""}),W=a([]),Y=l({fileUrl:[{required:!0,message:"请上传文件",trigger:"blur"}]}),Z=(e,a,l)=>{V.value.fileUrl=a.raw},$=()=>{V.value.fileUrl=""},ee=e=>{const a=e.name.substring(e.name.lastIndexOf(".")+1),l="xlsx"==a||"xls"==a;return l||v.warning("上传文件只能是 xls、xlsx格式!"),l},ae=async()=>{const{data:e}=await y();te(e.data)},le=async()=>{const{data:e}=await x();te(e.data)},te=e=>{const a=document.createElement("a");a.style.display="none",a.href=e,a.setAttribute("id","downloadLink"),a.setAttribute("download","模板.xls"),document.body.appendChild(a),a.click();const l=document.getElementById("downloadLink");document.body.removeChild(l)},se=()=>{b.value.validate((async e=>{if(e){const e=new FormData;e.append("file",V.value.fileUrl),await h(e),V.value.fileUrl="",v.success("导入成功!!"),T.value=[],oe()}}))},oe=async()=>{const{data:e}=await _({page:p.currentPage,limit:p.pageSize});p.total=e.data.total,W.value=e.data.data};return t((()=>{oe()})),z(((e,a)=>{const l=s("el-col"),t=s("el-row"),g=s("el-button"),v=s("el-upload"),y=s("el-form-item"),x=s("el-tooltip"),h=s("el-form"),_=s("el-card"),te=s("el-empty"),oe=s("el-table-column"),ne=s("el-table"),re=s("el-pagination");return o(),n(u,null,[r(_,{shadow:"never"},{default:z((()=>[r(t,null,{default:z((()=>[r("div",k,[r(l,{lg:24,class:"tips-text"},{default:z((()=>[U,j,S,A,E,L,B,F,I])),_:1})])])),_:1}),r("div",q,[r(h,{model:V.value,rules:d(Y),ref:b,"label-width":"80px",class:"demo-ruleForm"},{default:z((()=>[r(y,{label:"上传文件",prop:"fileUrl"},{default:z((()=>[r("div",O,[r(v,{class:"upload-demo",action:"https://jsonplaceholder.typicode.com/posts/","on-success":Z,"file-list":T.value,"before-upload":ee,"on-remove":$,limit:1,accept:".xlsx,.xls"},{default:z((()=>[r(g,{size:"small",plain:"",type:"primary"},{default:z((()=>[P])),_:1})])),_:1},8,["file-list"]),r("div",{class:"download-box"},[r("div",{class:"download-text",onClick:le},"下载Excel模板"),r("div",{class:"download-text",onClick:ae},"快递公司对照模板")])])])),_:1}),r("div",R,[D,r(x,{class:"item",effect:"light",placement:"top"},{content:z((()=>[X,G,H,J,K])),default:z((()=>[M])),_:1})]),r(g,{type:"primary",class:"now-output",onClick:se},{default:z((()=>[N])),_:1})])),_:1},8,["model","rules"])])])),_:1}),r(_,{shadow:"never",class:"delivery-content custom-crad-container custom-card-page"},{default:z((()=>[r(ne,{class:"table-box",data:W.value,style:{width:"100%"}},{empty:z((()=>[r(te,{class:"oe-m-t-30",description:"暂无批量发货"})])),default:z((()=>[r(oe,{label:"文件名称","min-width":"210",prop:"file_name"}),r(oe,{prop:"order_num",label:"导入订单数"}),r(oe,{prop:"address",label:"发货时间","min-width":"150"},{default:z((e=>[r("div",null,i(d(w)(e.row.createtime)),1)])),_:1}),r(oe,{prop:"order_success",label:"成功","min-width":"70"}),r(oe,{prop:"order_error",label:"失败","min-width":"70"}),r(oe,{prop:"address",label:"操作","min-width":"80"},{default:z((e=>[e.row.order_success!=e.row.order_num?(o(),n(g,{key:0,size:"small",type:"primary",onClick:a=>(async e=>{const{data:a}=await C({batch_id:e.id}),l=new Blob([a]),t=window.URL.createObjectURL(l),s=document.createElement("a");s.style.display="none",s.href=t,s.setAttribute("download","失败订单.xlsx"),document.body.appendChild(s),s.click()})(e.row)},{default:z((()=>[Q])),_:2},1032,["onClick"])):c("",!0)])),_:1})])),_:1},8,["data"]),r(l,{lg:24,class:"paging-box"},{default:z((()=>[r(re,{"page-sizes":d(p).pageSizes,"page-size":d(p).pageSize,onSizeChange:d(m),onCurrentChange:d(f),background:"","current-page":d(p).currentPage,layout:"total, prev, pager, next,sizes, jumper",total:d(p).total},null,8,["page-sizes","page-size","onSizeChange","onCurrentChange","current-page","total"])])),_:1})])),_:1})],64)}))}});T.__scopeId="data-v-7e6fc5d3";export default T;
